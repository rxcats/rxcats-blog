"use strict";(self.webpackChunkrxcats_blog=self.webpackChunkrxcats_blog||[]).push([[2935],{5680:(e,a,t)=>{t.d(a,{xA:()=>m,yg:()=>p});var n=t(6540);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function l(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?l(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function s(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)t=l[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)t=l[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var o=n.createContext({}),y=function(e){var a=n.useContext(o),t=a;return e&&(t="function"==typeof e?e(a):i(i({},a),e)),t},m=function(e){var a=y(e.components);return n.createElement(o.Provider,{value:a},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},g=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,l=e.originalType,o=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),c=y(t),g=r,p=c["".concat(o,".").concat(g)]||c[g]||u[g]||l;return t?n.createElement(p,i(i({ref:a},m),{},{components:t})):n.createElement(p,i({ref:a},m))}));function p(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var l=t.length,i=new Array(l);i[0]=g;var s={};for(var o in a)hasOwnProperty.call(a,o)&&(s[o]=a[o]);s.originalType=e,s[c]="string"==typeof e?e:r,i[1]=s;for(var y=2;y<l;y++)i[y]=t[y];return n.createElement.apply(null,i)}return n.createElement.apply(null,t)}g.displayName="MDXCreateElement"},8442:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>o,contentTitle:()=>i,default:()=>u,frontMatter:()=>l,metadata:()=>s,toc:()=>y});var n=t(8168),r=(t(6540),t(5680));const l={slug:"flyway",title:"flyway \ub97c \uc774\uc6a9\ud55c \ub370\uc774\ud130\ubca0\uc774\uc2a4 schema \uad00\ub9ac",authors:["rxcats"],tags:["flyway"],date:new Date("2023-11-30T03:00:00.000Z")},i=void 0,s={permalink:"/rxcats-blog/blog/flyway",source:"@site/blog/2023-11-30-flyway.mdx",title:"flyway \ub97c \uc774\uc6a9\ud55c \ub370\uc774\ud130\ubca0\uc774\uc2a4 schema \uad00\ub9ac",description:"DB schema \ubc84\uc804\uad00\ub9ac",date:"2023-11-30T03:00:00.000Z",formattedDate:"November 30, 2023",tags:[{label:"flyway",permalink:"/rxcats-blog/blog/tags/flyway"}],hasTruncateMarker:!1,authors:[{name:"rxcats",title:"Game Backend Developer",url:"https://github.com/rxcats",imageURL:"https://avatars.githubusercontent.com/u/6582519?v=4",key:"rxcats"}],frontMatter:{slug:"flyway",title:"flyway \ub97c \uc774\uc6a9\ud55c \ub370\uc774\ud130\ubca0\uc774\uc2a4 schema \uad00\ub9ac",authors:["rxcats"],tags:["flyway"],date:"2023-11-30T03:00:00.000Z"},prevItem:{title:"Apache POI autoSizeColumn() \uc0ac\uc6a9\uc2dc \uc624\ub798 \uac78\ub9ac\ub294 \uc99d\uc0c1",permalink:"/rxcats-blog/blog/apache-poi-auto-size-column"},nextItem:{title:"Retrying Feign Calls",permalink:"/rxcats-blog/blog/openfeign-retry"}},o={authorsImageUrls:[void 0]},y=[{value:"DB schema \ubc84\uc804\uad00\ub9ac",id:"db-schema-\ubc84\uc804\uad00\ub9ac",level:2},{value:"schema sql \ud30c\uc77c \uad00\ub9ac \uc608\uc2dc",id:"schema-sql-\ud30c\uc77c-\uad00\ub9ac-\uc608\uc2dc",level:3},{value:"seed sql \ud30c\uc77c \uad00\ub9ac \uc608\uc2dc",id:"seed-sql-\ud30c\uc77c-\uad00\ub9ac-\uc608\uc2dc",level:3},{value:"project \ub514\ub809\ud1a0\ub9ac \uad6c\uc131",id:"project-\ub514\ub809\ud1a0\ub9ac-\uad6c\uc131",level:3},{value:"gradle Task \ub97c \uc774\uc6a9\ud55c \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc608\uc2dc",id:"gradle-task-\ub97c-\uc774\uc6a9\ud55c-\ub9c8\uc774\uadf8\ub808\uc774\uc158-\uc608\uc2dc",level:3}],m={toc:y},c="wrapper";function u(e){let{components:a,...t}=e;return(0,r.yg)(c,(0,n.A)({},m,t,{components:a,mdxType:"MDXLayout"}),(0,r.yg)("h2",{id:"db-schema-\ubc84\uc804\uad00\ub9ac"},"DB schema \ubc84\uc804\uad00\ub9ac"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"flyway \uc640 gradle task \ub97c \ud65c\uc6a9\ud558\uc5ec db schema \ub97c \uad00\ub9ac\ud558\uae30 \uc704\ud55c \ubaa9\uc801")),(0,r.yg)("h3",{id:"schema-sql-\ud30c\uc77c-\uad00\ub9ac-\uc608\uc2dc"},"schema sql \ud30c\uc77c \uad00\ub9ac \uc608\uc2dc"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"\uc608\uc2dc) V2023011900001__Create_admin_user.sql"),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"V : Prefix (Version)"),(0,r.yg)("li",{parentName:"ul"},"20230119 : \uc0dd\uc131\ub0a0\uc9dc"),(0,r.yg)("li",{parentName:"ul"},"00001 : \uc0dd\uc131 \uc21c\ubc88"),(0,r.yg)("li",{parentName:"ul"},"__ : Separator"),(0,r.yg)("li",{parentName:"ul"},"Create : CRUD \uad6c\ubd84"),(0,r.yg)("li",{parentName:"ul"},"admin_user : \ud14c\uc774\ube14\uba85")))),(0,r.yg)("h3",{id:"seed-sql-\ud30c\uc77c-\uad00\ub9ac-\uc608\uc2dc"},"seed sql \ud30c\uc77c \uad00\ub9ac \uc608\uc2dc"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"\ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc9c4\ud589\uc2dc \ub9e4\ubc88 \uc2e4\ud589\ub418\ub294 sql \ub85c \uc8fc\ub85c \ub370\uc774\ud130\ub97c \uc785\ub825\ud574\uc8fc\uae30 \uc704\ud55c \uae30\ub2a5")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"\uc608\uc2dc) R__001_Seed_admin_menu.sql"),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"R : Prefix (Repeatable)"),(0,r.yg)("li",{parentName:"ul"},"__ : Separator"),(0,r.yg)("li",{parentName:"ul"},"001 : \uc21c\ubc88"),(0,r.yg)("li",{parentName:"ul"},"Seed : Seed \uba85\uc2dc"),(0,r.yg)("li",{parentName:"ul"},"admin_menu : \ud14c\uc774\ube14\uba85")))),(0,r.yg)("h3",{id:"project-\ub514\ub809\ud1a0\ub9ac-\uad6c\uc131"},"project \ub514\ub809\ud1a0\ub9ac \uad6c\uc131"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"root",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"conf : \uc124\uc815 \ub514\ub809\ud1a0\ub9ac (db \uacc4\uc815 \ub4f1)",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"admin.gradle.conf : admin DB \uc124\uc815"))),(0,r.yg)("li",{parentName:"ul"},"migration : schema sql",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"admin",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"V2023011900001__Create_admin_user.sql"),(0,r.yg)("li",{parentName:"ul"},"V2023011900002__Create_admin_menu.sql"))))),(0,r.yg)("li",{parentName:"ul"},"seed : seed sql",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"admin",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"R__001_Seed_admin_user.sql"),(0,r.yg)("li",{parentName:"ul"},"R__002_Seed_admin_menu.sql")))))))),(0,r.yg)("h3",{id:"gradle-task-\ub97c-\uc774\uc6a9\ud55c-\ub9c8\uc774\uadf8\ub808\uc774\uc158-\uc608\uc2dc"},"gradle Task \ub97c \uc774\uc6a9\ud55c \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc608\uc2dc"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-gradle",metastring:"build.gradle.kts","build.gradle.kts":!0},'// flyway gradle plugin \uc124\uc815\nplugins {\n    id("org.flywaydb.flyway") version "9.20.1"\n}\n\n// flyway \uac00 gradle task \uc2e4\ud589\uc2dc DB\uc5d0 \uc811\uadfc\ud560 \uc218 \uc788\ub3c4\ub85d \ud558\uae30 \uc704\ud574 buildscript \uc548\uc5d0 classpath \uc758\uc874\uc131\uc744 \ucd94\uac00 \ud574 \uc918\uc57c \ud568\nbuildscript {\n    dependencies {\n        // classpath dependencies require for flyway database migrate\n        classpath("org.flywaydb:flyway-mysql:9.20.1")\n        classpath("com.mysql:mysql-connector-j:8.0.33")\n    }\n}\n\nval flywayAdminDbLocations = arrayOf("filesystem:db/migration/admin", "filesystem:db/seed/admin")\n\n// \ub9c8\uc774\uadf8\ub808\uc774\uc158 Task \ub4f1\ub85d\n// \uc2e4\ud589 : `./gradlew adminDbMigrate`\ntasks.register<FlywayMigrateTask>("adminDbMigrate") {\n    // \ud504\ub85c\uc81d\ud2b8\uc5d0\uc11c flyway \ub9c8\uc774\uadf8\ub808\uc774\uc158\uc774 \uc788\ub294 \uacbd\ub85c\n    workingDirectory = "${rootDir.absolutePath}/db-migration"\n\n    // admin db \uc5d0 \ud574\ub2f9\ub418\ub294 \uc124\uc815\ud30c\uc77c\uacfc \uc2a4\ud0a4\ub9c8, seed sql \uc774 \uc788\ub294 \ub514\ub809\ud1a0\ub9ac \uacbd\ub85c\n    configFiles = arrayOf("conf/admin.gradle.conf")\n\n    // flyway.locations \uc5d0 \ud574\ub2f9\ub418\ub294 \uacbd\ub85c \uc124\uc815\n    locations = arrayOf("filesystem:db/migration/admin", "filesystem:db/seed/admin")\n\n    baselineOnMigrate = true\n}\n\n// clean Task \ub4f1\ub85d (drop tables)\n// \uc2e4\ud589 : `./gradlew adminDbClean`\ntasks.register<FlywayCleanTask>("adminDbClean") {\n    workingDirectory = "${rootDir.absolutePath}/db-migration"\n    configFiles = arrayOf("conf/admin.gradle.conf")\n    locations = arrayOf("filesystem:db/migration/admin", "filesystem:db/seed/admin")\n    baselineOnMigrate = true\n    cleanDisabled = false\n}\n\n')))}u.isMDXComponent=!0}}]);